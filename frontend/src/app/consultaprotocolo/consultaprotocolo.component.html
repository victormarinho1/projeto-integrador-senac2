<div class="min-h-screen bg-gray-100 py-10 px-4 sm:px-6 lg:px-8">
  <div
    class="max-w-xl mx-auto bg-white rounded-xl shadow-xl p-6 sm:p-8 lg:p-10"
  >
    <div *ngIf="!isLoading && !denuncia && !errorMessage">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
          Consultar Andamento
        </h1>
        <p class="text-lg text-gray-600 mt-2">
          Insira o número do protocolo para ver o status da sua denúncia.
        </p>
      </div>

      <form [formGroup]="consultaForm" (ngSubmit)="onSubmit()">
        <div class="space-y-4">
          <div>
            <label
              for="protocolo"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Número do Protocolo
            </label>

            <input
              id="protocolo"
              type="text"
              pInputText
              formControlName="protocolo"
              placeholder="DEN-20251106213406-XXXXXXXX"
              class="w-full uppercase"
              [ngClass]="{ 'ng-invalid ng-dirty': submitted && f['protocolo'].errors }"
            />

            <div *ngIf="submitted && f['protocolo'].errors" class="text-red-500 text-sm mt-1">
              <span *ngIf="f['protocolo'].errors['required']">
                O protocolo é obrigatório.
              </span>
              <span *ngIf="f['protocolo'].errors['pattern']">
                O formato do protocolo é inválido. (Ex: DEN-20251106213406-DC6B76DD)
              </span>
            </div>

          </div>

          <p-button
            label="Consultar Protocolo"
            type="submit"
            styleClass="w-full"
            icon="pi pi-search"
          ></p-button>
        </div>
      </form>
    </div>

    <div *ngIf="isLoading" class="text-center py-10">
      <p-progressSpinner
        styleClass="w-16 h-16"
        strokeWidth="4"
      ></p-progressSpinner>
      <p class="text-xl text-gray-700 mt-4 font-medium">Consultando...</p>
    </div>

    <div *ngIf="!isLoading && errorMessage">
      <div class="text-center">
        <i
          class="pi pi-times-circle text-red-500"
          style="font-size: 4rem"
        ></i>
        <h2 class="text-2xl font-bold text-gray-800 mt-4">
          Denúncia não encontrada
        </h2>
        <p-message severity="error" [text]="errorMessage" styleClass="mt-6 justify-start"></p-message>
        <p-button
          label="Tentar Novamente"
          (click)="resetConsulta()"
          styleClass="w-full max-w-xs mt-6"
          icon="pi pi-refresh"
        ></p-button>
      </div>
    </div>

    <div *ngIf="!isLoading && denuncia">
      <div class="text-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900">
          Andamento da Denúncia
        </h1>
      </div>
      <div
        class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-8 text-center"
      >
        <p class="text-sm text-gray-600">Protocolo</p>
        <p class="text-2xl font-bold text-gray-800 break-all">{{ denuncia.protocolo }}</p>
        <p class="text-sm text-gray-600 mt-2">Status Atual</p>
        <p class="text-xl font-semibold text-blue-600">
          {{ statusAtual }}
        </p>
      </div>
      <h3 class="text-xl font-semibold text-gray-800 mb-4">Histórico:</h3>
      <p-timeline [value]="denuncia.historico" align="alternate">
        <ng-template pTemplate="content" let-evento>
          <p-card [header]="evento.status" [subheader]="evento.data">
            <p>{{ evento.descricao }}</p>
          </p-card>
        </ng-template>
        <ng-template pTemplate="marker" let-evento>
          <span
            class="flex w-8 h-8 items-center justify-center text-white rounded-full z-10 shadow-md"
            [style.background-color]="evento.color"
          >
            <i [class]="evento.icon"></i>
          </span>
        </ng-template>
      </p-timeline>
       <div class="text-center mt-8 border-t pt-6">
         <p-button
            label="Consultar Outro Protocolo"
            (click)="resetConsulta()"
            styleClass="p-button-outlined"
            icon="pi pi-search"
          ></p-button>
       </div>
    </div>
  </div>
</div>
